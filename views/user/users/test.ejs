<script>

const couponmanagement = async (req, res) => {
    try {
        const coupondata = await coupon.find()
        res.render('coupon', { coupondata });
    } catch (error) {
        console.log(error.message);
    }
}


const addcoupon = async (req, res) => {
    try {
        res.render('addcoupon')

    } catch (error) {
        console.log(error.message);
    }
}

const coupondata = async (req, res) => {
    try {

        const data = new coupon({
            couponname: req.body.couponname,
            couponcode: req.body.couponcode,
            discountamount: req.body.discountamount,
            activationdate: req.body.activationdate,
            expirydate: req.body.expirydate,
            criteriaamount: req.body.criteriaamount,
            userslimit: req.body.userslimit,
            description: req.body.description

        })
        await data.save()
        console.log(data);
        res.redirect('/admin/coupon')

    } catch (error) {
        console.log(error.message);
    }
}

const editingcoupon = async (req, res) => {
    try {
        const id = req.query.id
        const coupondata = await coupon.findOne({ _id: id });

        res.render('editcoupon', { coupondata })

    } catch (error) {
        console.log(error.message);
    }

}

const editedcoupondata = async (req, res) => {
    try {
        const id = req.query.id

        await coupon.updateOne({ _id: id }, {
            $set: {
                couponname: req.body.couponname,
                couponcode: req.body.couponcode,
                discountamount: req.body.discountamount,
                activationdate: req.body.activationdate,
                expirydate: req.body.expirydate,
                criteriaamount: req.body.criteriaamount,
                userslimit: req.body.userslimit,
                description: req.body.description
            }
        })
        res.redirect('/admin/coupon')


    } catch (error) {
        console.log(error.message);
    }
}

const blockunblockcoupon = async(req,res)=>{
    try {
        const id=req.body.id
        const couponid = req.body.couponid
        console.log(couponid,id);
        if(id==1){
            await coupon.updateOne({_id:couponid},{$set:{status:1}});
            res.json({result:true})
        }else{
            await coupon.updateOne({_id:couponid},{$set:{status:0}})
            res.json({result:true})
        }
    } catch (error) {
        console.log(error.message);
        
    }
}

const deletecoupon = async(req,res)=>{
    try {
        const id = req.body.id
        console.log(id);
        await coupon.deleteOne({_id:id})
        res.json({result:true})

    } catch (error) {
        console.log(error.message);
    }
}
</script>