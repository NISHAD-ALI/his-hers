ACCOUNT DETAILS FORM 


<!-- <form action="#">
    <div class="row">
        <div class="col-sm-6">
            <label>First Name</label>
            <input type="text" class="form-control" required>
    </div>

        <div class="col-sm-6">
            <label>Last Name *</label>
            <input type="text" class="form-control" required>
        </div>
    </div>
    <label>Display Name *</label>
    <input type="text" class="form-control" required>
    <small class="form-text">This will be how your name will be displayed in the account section and in reviews</small>

    <label>Email address *</label>
    <input type="email" class="form-control" required>

    <label>Current password (leave blank to leave unchanged)</label>
    <input type="password" class="form-control">

    <label>New password (leave blank to leave unchanged)</label>
    <input type="password" class="form-control">

    <label>Confirm new password</label>
    <input type="password" class="form-control mb-2">

    <button type="submit" class="btn btn-outline-primary-2">
        <span>SAVE CHANGES</span>
        <i class="icon-long-arrow-right"></i>
    </button>
</form> -->


<%- include('../partials/user/header') %>
<!-- Content page -->
<section class="bg0 p-t-75 p-b-120 mainSec">
    <div class="container">
      <main class="container mt-4">
        <section class="profile">
          <div class="row">
            <div class="col-md-4 text-center">
              <% if (userProfile.profile) { %>
              <img src="<%= userProfile.profile  %>" alt="User Profile Picture" class="img-fluid rounded-circle" style="height: 200px; width: 200px; margin-left: -53px;">
              <div class="row mb-3" style="margin-top: 10px;">
                <div class="col-sm-10">
                  <div class="d-flex justify-content-center">
                    <a href="/profile/deletePhoto" class="btn btn-danger profile-button">Remove profile</a>
                  </div>
                  <% } else { %>
                  <img src="images/defaultProfile.jpg" alt="User Profile Picture" class="img-fluid rounded-circle profile-picture" style="height: 200px; width: 200px; margin-left: -53px;">
                  <div class="row mb-3" style="margin-top: 10px;">
                    <div class="col-sm-10">
                      <% } %>
                      <label class="col-form-label" for="profile-picture" style="margin-top: 20px;">Change Profile</label>
                      <form action="/profile/editPhoto?_method=PATCH" method="post" enctype="multipart/form-data">
                        <input type="file" accept="image/*" name="image" class="form-control file-upload-info" placeholder="Upload Image" id="preview-input" />
                        <button type="submit" class="btn btn-primary profile-button" style="margin-top: 15px;">Update profile</button><br>
                      </form>
                      <% if(typeof error !== "undefined"){ %>
                      <div style="margin-top: 8px;">
                        <span style="color:#f00; font-weight: bold;"><%= error %></span>
                      </div>
                      <% } %>
                    </div>
                  </div>
                </div>
                <div class="col-md-8" style="margin-top: 10px;">
                  <h1 class="profile-name"><%= userProfile.firstName %> <%= userProfile.lastName %></h1>
                  <p class="profile-email mt-2">Email: <%= userProfile.email %></p>
                  <p class="profile-mobile mt-2">Mobile: <%= userProfile.phone %></p>
                  <div style="margin-top: 8px;">
                    <a href="/change-password">Change Password</a>
                  </div>
                  <!-- Add other user information here -->
                  <div style="margin-top: 10px;">
                    <a href="/edit-profile?id=<%= userProfile._id %>" class="btn btn-primary profile-button" id="edit-profile-button">Edit Profile</a>
                    <a href="/logout" class="btn btn-danger profile-button" id="logout-button">Logout</a> <!-- Logout button -->
                  </div>
                  <div style="margin-top: 10px;">
                    <a href="/order" class="btn btn-primary profile-button" id="edit-profile-button">My Orders</a>
                    <a href="/wallet" class="btn btn-primary profile-button" id="edit-profile-button">My Wallet</a>
                    <a href="/coupons" class="btn btn-primary profile-button" id="edit-profile-button">Coupons</a>
                  </div>
                  <section class="bg-light p-4" style="margin-top: 20px;">
                    <h2 class="mb-4">Addresses</h2>
                    <div class="row">
                      <!-- Add Address Button -->
                      <div class="col-md-12 ">
                        <a href="/add-address" class="btn btn-success" id="add-address-button">Add Address</a>
                      </div>
                <%
                if (userAddress.length > 0) {
                 for (let i = 0; i < userAddress.length; i++) {
                %>
                      <div class="col-md-6 mb-4 mt-4">
                        <div class="card">
                          <div class="card-body">
                            <h5 class="card-title">Address <%= i+1 %></h5>
                            <p class="card-text"><%= userAddress[i].name %>, <%= userAddress[i].district %>, <%= userAddress[i].state %>, <%= userAddress[i].country %></p>
                            <a href="/edit-address?id=<%= userAddress[i]._id %>" class="btn btn-primary btn-sm">Edit</a>
                            <a href="/delete-address?id=<%= userAddress[i]._id %>" class="btn btn-danger btn-sm">Delete</a>
                          </div>
                        </div>
                      </div>
                <%
                        }
                    } else {
                %>
  
                      <div style="margin-top: 20px;">
                        <h4>You are not added address</h4>
                      </div>
  
                      <% } %>
  
                      <!-- Add more addresses here... -->
                    </div>
                  </section>
  
                </div>
              </div>
        </section>
  
  
      </main>
    </div>
  </section>
  <%- include('../partials/user/footer') %>



  <tbody>
    <% if(cartData) {%>
       <% let product = cartData.products %>
   <% for (let i = 0; i < product.length; i++) { %>
     <% const value = product[i].productId; %>
     <tr>
       <td class="product-col">
         <div class="product">
           <figure class="product-media">
             <a href="#">
               <img src="/products/images/<%= value[i].products[i].productId.image[0]" alt="Product image">

             </a>
           </figure>
           <h3 class="product-title">
               <a href="#"><%= value.productname %></a>

           </h3>
           <!-- Rest of your product details rendering -->
         </div>
       </td>
       <td class="price-col"><%= value.price %></td>
       <td class="quantity-col">
         <div class="cart-product-quantity">
           <input type="number" class="form-control" value="1" min="1" max="10" step="1" data-decimals="0" required>
         </div>
       </td>
       <td class="total-col">$<%= value.price %></td>
       <td class="remove-col"><button class="btn-remove"><i class="icon-close"></i></button></td>
     </tr>
     <% if (value.quantity === 0) { %>
       <tr>
         <td colspan="5">
           <p style="color: red"><b>Out of Stock !</b></p>
         </td>
       </tr>
     <% } %>
   <% } %>
   <%}%>
 </tbody>



 <!DOCTYPE html>
<html lang="en">


<!-- molla/cart.html  22 Nov 2019 09:55:06 GMT -->
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Shozey</title>
    <meta name="keywords" content="HTML5 Template">
    <meta name="description" content="Molla - Bootstrap eCommerce Template">
    <meta name="author" content="p-themes">
    <!-- Favicon -->
    <link rel="apple-touch-icon" sizes="180x180" href="assets/images/icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="assets/images/icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="assets/images/icons/favicon-16x16.png">
    <link rel="manifest" href="assets/images/icons/site.html">
    <link rel="mask-icon" href="assets/images/icons/safari-pinned-tab.svg" color="#666666">
    <link rel="shortcut icon" href="assets/images/icons/favicon.ico">
    <meta name="apple-mobile-web-app-title" content="Molla">
    <meta name="application-name" content="Molla">
    <meta name="msapplication-TileColor" content="#cc9966">
    <meta name="msapplication-config" content="assets/images/icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <!-- Plugins CSS File -->
    <link rel="stylesheet" href="assets/css/bootstrap.min.css">
    <!-- Main CSS File -->
    <link rel="stylesheet" href="assets/css/style.css">
</head>

<body>
    <div class="page-wrapper">
        <header class="header">
           

            <div class="header-middle sticky-header">
                <div class="container">
                    <div class="header-left">
                        <button class="mobile-menu-toggler">
                            <span class="sr-only">Toggle mobile menu</span>
                            <i class="icon-bars"></i>
                        </button>

                        <h1 class="display-4 text-center mt-3" style="color: #00008B; font-weight: bold; text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5); font-family: 'Cursive', sans-serif; letter-spacing: 2px; text-transform: uppercase;">SHOZEY</h1>

                        <nav class="main-nav">
                            <ul class="menu sf-arrows">
                                <li class="megamenu-container active">
                                    <a href="/" class="sf-with-ul">Home</a>

                                    
                                </li>
                                <li>
                                    <a href="category.html" class="sf-with-ul">Shop</a>

                                   
                                </li>
                                <li>
                                    <a href="product.html" class="sf-with-ul">Product</a>

                                </li>
                                <li>
                                    <a href="#" class="sf-with-ul">Pages</a>

                                    <ul>
                                        <li>
                                            <a href="about.html" class="sf-with-ul">About</a>

                                            <ul>
                                                <li><a href="about.html">About 01</a></li>
                                                <li><a href="about-2.html">About 02</a></li>
                                            </ul>
                                        </li>
                                        <li>
                                            <a href="contact.html" class="sf-with-ul">Contact</a>

                                            <ul>
                                                <li><a href="contact.html">Contact 01</a></li>
                                                <li><a href="contact-2.html">Contact 02</a></li>
                                            </ul>
                                        </li>
                                        <li><a href="login.html">Login</a></li>
                                        <li><a href="faq.html">FAQs</a></li>
                                        <li><a href="404.html">Error 404</a></li>
                                        <li><a href="coming-soon.html">Coming Soon</a></li>
                                    </ul>
                                </li>
                                <li>
                                    <a href="blog.html" class="sf-with-ul">Blog</a>

                                    <ul>
                                        <li><a href="blog.html">Classic</a></li>
                                        <li><a href="blog-listing.html">Listing</a></li>
                                        <li>
                                            <a href="#">Grid</a>
                                            <ul>
                                                <li><a href="blog-grid-2cols.html">Grid 2 columns</a></li>
                                                <li><a href="blog-grid-3cols.html">Grid 3 columns</a></li>
                                                <li><a href="blog-grid-4cols.html">Grid 4 columns</a></li>
                                                <li><a href="blog-grid-sidebar.html">Grid sidebar</a></li>
                                            </ul>
                                        </li>
                                        <li>
                                            <a href="#">Masonry</a>
                                            <ul>
                                                <li><a href="blog-masonry-2cols.html">Masonry 2 columns</a></li>
                                                <li><a href="blog-masonry-3cols.html">Masonry 3 columns</a></li>
                                                <li><a href="blog-masonry-4cols.html">Masonry 4 columns</a></li>
                                                <li><a href="blog-masonry-sidebar.html">Masonry sidebar</a></li>
                                            </ul>
                                        </li>
                                        <li>
                                            <a href="#">Mask</a>
                                            <ul>
                                                <li><a href="blog-mask-grid.html">Blog mask grid</a></li>
                                                <li><a href="blog-mask-masonry.html">Blog mask masonry</a></li>
                                            </ul>
                                        </li>
                                        <li>
                                            <a href="#">Single Post</a>
                                            <ul>
                                                <li><a href="single.html">Default with sidebar</a></li>
                                                <li><a href="single-fullwidth.html">Fullwidth no sidebar</a></li>
                                                <li><a href="single-fullwidth-sidebar.html">Fullwidth with sidebar</a></li>
                                            </ul>
                                        </li>
                                    </ul>
                                </li>
                                <li>
                                    <% if (!user) { %>
                                        <li>
                                            <a href="#" class="sf-with-ul">Profile</a>
                                            <ul>
                                              <li><a href="/signin">Login</a></li>
                                              <li><a href="/profile">Profile</a></li>
                                              <li><a href="/cart">Cart</a></li>
                                            </ul>
                                          </li>
                                      <% } else { %>
                                        
                                        <li>
                                            <a href="#" class="sf-with-ul"><%= user %></a>
                                            <ul>
                                              <li><a href="/signin">Login</a></li>
                                              <li><a href="/logout">Logout</a></li>
                                              <li><a href="/profile">Profile</a></li>
                                              <li><a href="/cart">Cart</a></li>
                                            </ul>
                                          </li>
                                      <% } %>

                                </li>
                            </ul><!-- End .menu -->
                        </nav><!-- End .main-nav -->
                    </div><!-- End .header-left -->

                    <div class="header-right">
                        <div class="header-search">
                            <a href="#" class="search-toggle" role="button" title="Search"><i class="icon-search"></i></a>
                            <form action="#" method="get">
                                <div class="header-search-wrapper">
                                    <label for="q" class="sr-only">Search</label>
                                    <input type="search" class="form-control" name="q" id="q" placeholder="Search in..." required>
                                </div><!-- End .header-search-wrapper -->
                            </form>
                        </div><!-- End .header-search -->
                        <div class="dropdown compare-dropdown">
                            <a href="#" class="dropdown-toggle" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" data-display="static" title="Compare Products" aria-label="Compare Products">
                                <i class="icon-random"></i>
                            </a>

                            <div class="dropdown-menu dropdown-menu-right">
                              
                                <ul class="compare-products">
                                    <li class="compare-product">
                                        <a href="#" class="btn-remove" title="Remove Product"><i class="icon-close"></i></a>
                                        <h4 class="compare-product-title"><a href="product.html">Blue Night Dress</a></h4>
                                    </li>
                                    <li class="compare-product">
                                        <a href="#" class="btn-remove" title="Remove Product"><i class="icon-close"></i></a>
                                        <h4 class="compare-product-title"><a href="product.html">White Long Skirt</a></h4>
                                    </li>
                                </ul>

                                <div class="compare-actions">
                                    <a href="#" class="action-link">Clear All</a>
                                    <a href="#" class="btn btn-outline-primary-2"><span>Compare</span><i class="icon-long-arrow-right"></i></a>
                                </div>
                            </div><!-- End .dropdown-menu -->
                        </div><!-- End .compare-dropdown -->

                        <div class="dropdown cart-dropdown" id="downCart">
                            <a href="#" class="dropdown-toggle" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" data-display="static">
                                <i class="icon-shopping-cart"></i>
                                <span class="cart-count">2</span>
                            </a>

                            <div class="dropdown-menu dropdown-menu-right">
                                <% cartdata.forEach((item)=>{%>
                                    <% item.items.forEach((element)=>{%>
                                <div class="dropdown-cart-products">
                                    <div class="product" >
                                        <div class="product-cart-details">
                                            <h4 class="product-title">
                                                <a href="product.html"><%= element.productid.productname %></a>
                                            </h4>
    
                                            <span class="cart-product-info">
                                                <span class="cart-product-qty"></span>
                                               <%= element.count %> x Rs.<%= element.productid.price * element.count %>
                                            </span>
                                        </div><!-- End .product-cart-details -->
    
                                        <figure class="product-image-container">
                                            <a href="" class="product-image">
                                                <img src="/productimages/<%= element.productid.image[0] %>" alt="product">
                                            </a>
                                        </figure>
                                        <a href="#" class="btn-remove" title="Remove Product"><i class="icon-close"></i></a>
                                    </div><!-- End .product -->
    
                                  
                                    
                                </div><!-- End .cart-product -->
                                <%}) %>
                                <% })%>

                                <div class="dropdown-cart-total">
                                    <span>Total</span>

                                    <span class="cart-total-price">Rs.<%= totalsum %></span>
                                </div><!-- End .dropdown-cart-total -->

                                <div class="dropdown-cart-action">
                                    <a href="/cart" class="btn btn-primary">View Cart</a>
                                    <a href="checkout.html" class="btn btn-outline-primary-2"><span>Checkout</span><i class="icon-long-arrow-right"></i></a>
                                </div><!-- End .dropdown-cart-total -->
                            </div><!-- End .dropdown-menu -->
                        </div><!-- End .cart-dropdown -->
                    </div><!-- End .header-right -->
                </div><!-- End .container -->
            </div><!-- End .header-middle -->
        </header><!-- End .header -->

        <main class="main">
        	<div class="page-header text-center" style="background-image: url('assets/images/page-header-bg.jpg')">
        		<div class="container">
        			<h1 class="page-title">Shopping Cart<span>Shop</span></h1>
        		</div><!-- End .container -->
        	</div><!-- End .page-header -->
            <nav aria-label="breadcrumb" class="breadcrumb-nav">
                <div class="container">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item"><a href="index.html">Home</a></li>
                        <li class="breadcrumb-item"><a href="#">Shop</a></li>
                        <li class="breadcrumb-item active" aria-current="page">Shopping Cart</li>
                    </ol>
                </div><!-- End .container -->
            </nav><!-- End .breadcrumb-nav -->

            <div class="page-content" id="Cart">
            	<div class="cart">
	                <div class="container">
	                	<div class="row" >
	                		<div class="col-lg-9">
	                			<table class="table table-cart table-mobile">
									<thead>
                                        <p id="shipping" style="color: red;" ></p>
										<tr>
											<th>Product</th>
											<th>Price</th>
											<th>Quantity</th>
											<th>Total</th>
											<th></th>
										</tr>
									</thead>

									<tbody>
										
                                        <% if (id) { %>
                                            <% if (cartdata.length > 0) { %>
                                                <% cartdata.forEach((item) => { %>
                                                    <% item.items.forEach((element) => { %>
                                                        <tr>
                                                            <td class="product-col">
                                                                <div class="product">
                                                                    <figure class="product-media">
                                                                        <a href="#">
                                                                            <img src="/productimages/<%= element.productid.image[0] %>" alt="Product image">
                                                                        </a>
                                                                    </figure>
                                        
                                                                    <h3 class="product-title">
                                                                        <a href="#"><%= element.productid.productname %></a>
                                                                    </h3>
                                                                </div>
                                                            </td>
                                                            <td class="price-col">Rs.<%= element.productid.price %></td>
                                                            <td class="quantity-col">
                                                                <div class="cart-product-quantity">
                                                                    <div class="input-group  input-spinner">
                                                                        <!-- <input type="number" class="form-control" value="<%= element.count %>" min="1" max="10" step="1" data-decimals="0" required> -->
                                                                        <div class="input-group-prepend">
                                                                    <button style="min-width: 26px" class="btn btn-decrement btn-spinner" onclick="AddingCount(-1,'<%= element.productid._id %>')" type="button" fdprocessedid="oe68nu">
                                                                        <i class="icon-minus"></i></button>
                                                                    </div>
                                                                    <input type="text" style="text-align: center" class="form-control " required="" placeholder="" fdprocessedid="kzohym"value="<%= element.count %>">
                                                                    <div class="input-group-append">
                                                                        <button style="min-width: 26px" class="btn btn-increment btn-spinner" onclick="AddingCount(1,'<%= element.productid._id %>')" type="button" fdprocessedid="4dpds">
                                                                            <i class="icon-plus"></i></button>
                                                                        </div>
                                                                    </div>
                                                            </td>
                                                            <td class="total-col">Rs.<%= element.productid.price * element.count %></td>
                                                            <td class="remove-col">
                                                                <a href="/deleteCartItems?id=<%= element.productid._id %>" class="btn-remove">
                                                                    <i class="icon-close"></i>
                                                                </a>
                                                            </td>
                                                        </tr>
                                                    <% }) %>
                                                <% }) %>
                                            <% } else { %>
                                                <tr>
                                                    <td colspan="5">Your cart is empty.</td>
                                                </tr>
                                            <% } %>
                                        <% } else { %>
                                            <tr>
                                                <td>This is the content for the table row.</td>
                                            </tr>
                                        <% } %>
                                        

									</tbody>
								</table><!-- End .table table-wishlist -->

	                			<div class="cart-bottom">
			            			<div class="cart-discount">
			            				<form action="#">
			            					<div class="input-group">
				        						<input type="text" class="form-control" required placeholder="coupon code">
				        						<div class="input-group-append">
													<button class="btn btn-outline-primary-2" type="submit"><i class="icon-long-arrow-right"></i></button>
												</div><!-- .End .input-group-append -->
			        						</div><!-- End .input-group -->
			            				</form>
			            			</div><!-- End .cart-discount -->

			            			<a href="#" class="btn btn-outline-dark-2"><span>UPDATE CART</span><i class="icon-refresh"></i></a>
		            			</div><!-- End .cart-bottom -->
	                		</div><!-- End .col-lg-9 -->
                            <% if(id){%>
	                		<aside class="col-lg-3" >
	                			<div class="summary summary-cart" id="shipping-options">
	                				<h3 class="summary-title">Cart Total</h3><!-- End .summary-title -->

	                				<table class="table table-summary">
	                					<tbody>
	                						<tr class="summary-subtotal" >
	                							<td>Subtotal:</td>
	                							<td >Rs.<%= totalsum %></td>
	                						</tr><!-- End .summary-subtotal -->
	                						<tr class="summary-shipping">
	                							<td>Shipping:</td>
	                							<td>&nbsp;</td>
	                						</tr>

	                						<tr class="summary-shipping-row">
	                							<td>
													<div class="custom-control custom-radio">
														<input type="radio" id="free-shipping" name="shipping" class="custom-control-input">
														<label class="custom-control-label" onclick="sample(0,'<%= totalsum%>')" for="free-shipping">Free Shipping</label>
													</div><!-- End .custom-control -->
	                							</td>
	                							<td>Rs.0.00</td>
	                						</tr><!-- End .summary-shipping-row -->

	                						<tr class="summary-shipping-row">
	                							<td>
	                								<div class="custom-control custom-radio">
														<input type="radio" id="standart-shipping" name="shipping" class="custom-control-input">
														<label class="custom-control-label"  onclick="sample(49,'<%= totalsum%>')" for="standart-shipping">Standart:</label>
													</div><!-- End .custom-control -->
	                							</td>
	                							<td>Rs.<%= standard%></td>
	                						</tr><!-- End .summary-shipping-row -->

	                						<tr class="summary-shipping-row">
	                							<td>
	                								<div class="custom-control custom-radio">
														<input type="radio" id="express-shipping" name="shipping" class="custom-control-input">
														<label class="custom-control-label" onclick="sample(99,'<%= totalsum%>')"  for="express-shipping">Express:</label>
													</div><!-- End .custom-control -->
	                							</td>
	                							<td>Rs.<%= express  %></td>
	                						</tr><!-- End .summary-shipping-row -->

	                						<tr class="summary-shipping-estimate">
	                							<td>Estimate for Your Country<br> <a href="dashboard.html">Change address</a></td>
	                							<td>&nbsp;</td>
	                						</tr><!-- End .summary-shipping-estimate -->

	                						<tr class="summary-total">
	                							<td>Total:</td>
	                							<td id="total" >Rs.<%= totalsum %> </td>
	                						</tr><!-- End .summary-total -->
	                					</tbody>
	                				</table><!-- End .table table-summary -->
                                        
	                				<a href="/ProceedtoCheckout" id="proceed-to-checkout" class="btn btn-outline-primary-2 btn-order btn-block">PROCEED TO CHECKOUT</a>
	                			</div><!-- End .summary -->

		            			<a href="category.html" class="btn btn-outline-dark-2 btn-block mb-3"><span>CONTINUE SHOPPING</span><i class="icon-refresh"></i></a>
	                		</aside><!-- End .col-lg-3 -->
                            <%}%>
                            
	                	</div><!-- End .row -->
	                </div><!-- End .container -->
                </div><!-- End .cart -->
            </div><!-- End .page-content -->
        </main><!-- End .main -->

      <script>
        function AddingCount(val,id){
        console.log("started");
        $.ajax({
            method:"post",
            url:"/AddingProductCount",
            data:JSON.stringify({id:id, val:val}),
            contentType:'application/json',
            success:function(response){
                if(response.result == true){
                   $('#Cart').load('/cart #Cart') 
                   $('#downCart').load('/cart #downCart') 

                } else if(response.result === false){
                    Swal.fire({
                    title:'OUT OF STOCK',
                    text:'product is out of stock',
                    icon:'failed',
                    confirmButtonText:'OK'
                });
                }
            }


        })
    }

    document.addEventListener("DOMContentLoaded", () => {
    const cart = document.getElementById('cart');
    const shipping = document.getElementById('shipping-options');
    const proceedCheckout = document.getElementById('proceed-to-checkout');

    proceedCheckout.addEventListener('click', (event) => {
        const selectedShipping = document.querySelector('input[name="shipping"]:checked');

        if (selectedShipping) {
            const shippingMethod = selectedShipping.value;
            console.log("Selected shipping method: " + shippingMethod);
        } else {
            const errorElement = document.getElementById('shipping');
            errorElement.textContent = 'Please select a shipping method before proceeding.';
            event.preventDefault(); 
        }
    });
});

function sample(val,totalsum) {
const finalamount = parseInt(val) + parseInt(totalsum);
console.log(finalamount);
const result = document.querySelector('#total');
result.textContent = "Rs" + parseInt(finalamount);
}

        </script>

        
<%- include('../user/layout/footer.ejs') -%>








Based on the code you've provided and your request to develop an AJAX code for incrementing and decrementing product quantity, you can use the following code to increment and decrement the product quantity:

First, let's create a simple AJAX function to send requests to the server to update the quantity:

```javascript
function updateQuantity(productId, newQuantity) {
    $.ajax({
        url: '/updateCartQuantity', // Replace with your server route
        method: 'POST',
        data: {
            productId: productId,
            newQuantity: newQuantity
        },
        success: function (data) {
            if (data.success) {
                // Update the cart total or perform any other actions as needed
                console.log('Cart updated successfully');
            } else {
                console.log('Failed to update cart');
            }
        },
        error: function () {
            console.log('Error updating cart');
        }
    });
}
```

Next, in your HTML template, add buttons for incrementing and decrementing the quantity:

```html
<!-- Decrement button -->
<button class="btn btn-decrement btn-spinner" type="button" onclick="decrementQuantity('<%= value.productId %>')">-</button>

<!-- Input field to display quantity -->
<input type="text" class="form-control" id="quantity-<%= value.productId %>" value="<%= value.count %>" readonly>

<!-- Increment button -->
<button class="btn btn-increment btn-spinner" type="button" onclick="incrementQuantity('<%= value.productId %>')">+</button>
```

Now, let's implement JavaScript functions to handle quantity changes:

```javascript
function incrementQuantity(productId) {
    let quantityInput = document.getElementById("quantity-" + productId);
    let currentQuantity = parseInt(quantityInput.value);

    // Increment the quantity
    quantityInput.value = currentQuantity + 1;

    // Send an AJAX request to update the quantity in the database
    updateQuantity(productId, currentQuantity + 1);
}

function decrementQuantity(productId) {
    let quantityInput = document.getElementById("quantity-" + productId);
    let currentQuantity = parseInt(quantityInput.value);

    // Check if the current quantity is greater than 1 before decrementing
    if (currentQuantity > 1) {
        // Decrement the quantity
        quantityInput.value = currentQuantity - 1;

        // Send an AJAX request to update the quantity in the database
        updateQuantity(productId, currentQuantity - 1);
    }
}
```

Ensure that the `updateCartQuantity` route on your server handles the quantity updates correctly.

With this code, you'll have buttons to increment and decrement the product quantity, and the AJAX requests will update the cart in the database accordingly. Make sure to adapt the code to your specific project and routes.


const AddingProductCount = async(req,res)=>{
  try {
     
      const productid=req.body.id;
      const id=req.session.userId
      const val =req.body.val
      const data = await product.findOne({_id:productid})
      console.log(data.quantity);
      if(data.quantity >0){
          if(val ==1){
              if(data.quantity >0 ){
           await cart.updateOne(
          { userid: id, "items.productid": productid },
          { $inc: { "items.$.count": 1 } });
          console.log("count increased");
          
          res.json({result:true});
          
          }
          else{
              res.json({result:false})
          }
          }

          else if(val == -1){
              
              await cart.updateOne(
               { userid: id, "items.productid": productid },
               { $inc: { "items.$.count": -1 } });
               console.log("count decreased");
              
               res.json({result:true})

          }
          
      }
        

  } catch (error) {
      console.log(error.message);
      
  }
}


const updateCartQuantity = async(req,res) => {
  try {
    const productId = req.body.id;
    const val = req.body.val;
    const userId = req.session.user_id;
    console.log('user'+userId);
    
    const data = await product.findOne({_id:productId})
      console.log(data.quantity);
      if(data.quantity >0){
          if( val ==  1 ){
              if( data.quantity >0  ){

           await Cart.updateOne(

          { userid: userId, "products.productId": productId },
          { $inc: { "products.$.count": 1 } });
          console.log("count increased");
          
          res.json({result:true});
          
          }
          else{
              res.json({result:false})
          }
          }

          else if(count == -1){
              
              await Cart.updateOne(
               { userid: id, "products.productId": productId },
               { $inc: { "products.$.count": -1 } });
               console.log("count decreased");
              
               res.json({result:true})

          }
          
      }
} catch (error) {

    console.error(error);
    res.status(500).json({ error: 'Internal server error' });
}
}
// const updateCartQuantity = async (req, res) => {
//   try {
//       const productId = req.body.id;
//       const val = req.body.val;
//       const userId = req.session.user_id;

//       const cartItem = await Cart.findOne({ userid: userId, "products.productId": productId });

//       if (cartItem) {
//           cartItem.products.forEach((product) => {
//               if (product.productId === productId) {
//                   if (val === 1) {
//                       // If the user increments when count is 1, increase by 1
//                       if (product.count === 1) {
//                           product.count += 1;
//                       } else {
//                           product.count += 1;
//                       }
//                   } else if (val === -1) {
//                       if (product.count > 1) {
//                           product.count -= 1;
//                       }
//                   }
//                   product.totalPrice = product.count * product.productPrice;
//               }
//           });

//           await cartItem.save();
//           res.json({ result: true });
//       } else {
//           res.json({ result: false });
//       }
//   } catch (error) {
//       console.error(error);
//       res.status(500).json({ error: 'Internal server error' });
//   }
// };
<script>
  const AddingProductCount = async(req,res)=>{
  try {
     
      const productid=req.body.id;
      const id=req.session.userId
      const val =req.body.val
      const data = await product.findOne({_id:productid})
      console.log(data.quantity);
      if(data.quantity >0){
          if(val ==1){
              if(data.quantity >0 ){
           await cart.updateOne(
          { userid: id, "items.productid": productid },
          { $inc: { "items.$.count": 1 } });
          console.log("count increased");
          
          res.json({result:true});
          
          }
          else{
              res.json({result:false})
          }
          }

          else if(val == -1){
              
              await cart.updateOne(
               { userid: id, "items.productid": productid },
               { $inc: { "items.$.count": -1 } });
               console.log("count decreased");
              
               res.json({result:true})

          }
          
      }
        

  } catch (error) {
      console.log(error.message);
      
  }
}
</script>
